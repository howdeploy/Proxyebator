---
phase: 06-wstunnel-backend-and-readme
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
autonomous: true
requirements:
  - DOC-01
  - DOC-02
  - DOC-03
  - DOC-04
  - DOC-05
  - DOC-06
must_haves:
  truths:
    - "README.md has a centered header with shields.io badges"
    - "README contains parameter tables (CLI flags, env vars, supported OS)"
    - "README uses collapsible details blocks for major sections"
    - "README has SOCKS5 setup instructions for Throne, nekoray/nekobox, Proxifier, and Surge"
    - "README has a copy-paste AI-assistant deployment block"
    - "README has a troubleshooting section with Cloudflare, DNS leaks, and TUN routing loop pitfalls"
    - "README is written in Russian"
  artifacts:
    - path: "README.md"
      provides: "Complete project documentation in Russian"
      min_lines: 300
      contains: "shields.io"
  key_links:
    - from: "README.md"
      to: "proxyebator.sh"
      via: "documented CLI commands and flags"
      pattern: "proxyebator\\.sh"
    - from: "README.md AI block"
      to: "server mode"
      via: "copy-paste deployment steps"
      pattern: "sudo.*proxyebator\\.sh server"
---

<objective>
Create a comprehensive Russian-language README.md for the proxyebator project.

Purpose: Any human or AI agent can deploy, configure, and troubleshoot the full stack by reading the README. The README serves as the single source of truth for users.

Output: README.md in the project root with all DOC-01 through DOC-06 requirements satisfied.
</objective>

<execution_context>
@/home/kosya/.claude/get-shit-done/workflows/execute-plan.md
@/home/kosya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-wstunnel-backend-and-readme/06-RESEARCH.md
@proxyebator.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create README.md with header, badges, and core sections</name>
  <files>README.md</files>
  <action>
Create README.md in the project root (`/home/kosya/vibecoding/proxyebator/README.md`). The entire README is in Russian. Use GitHub-flavored Markdown with HTML elements for badges and collapsible sections.

**Structure (top to bottom):**

**1. DOC-01: Centered header with shields.io badges**
```html
<div align="center">

# proxyebator

**Один скрипт. Один домен. Замаскированный SOCKS5-туннель через WebSocket.**

nginx + Chisel/wstunnel + TLS = трафик выглядит как обычный HTTPS

[![Platform](https://img.shields.io/badge/platform-Linux-blue)](https://github.com/)
[![Shell](https://img.shields.io/badge/shell-bash-89e051)](https://github.com/)
[![License](https://img.shields.io/badge/license-MIT-green)](LICENSE)
[![Chisel](https://img.shields.io/badge/backend-chisel-orange)](https://github.com/jpillora/chisel)
[![wstunnel](https://img.shields.io/badge/backend-wstunnel-blueviolet)](https://github.com/erebe/wstunnel)

</div>
```

**2. Brief "What is this" section (2-3 sentences)**

Explain: one-script installer that sets up a masked WebSocket tunnel. Supports Chisel and wstunnel backends. Traffic looks like normal HTTPS to an observer.

**3. How it works (short)**

Numbered list: 1) nginx serves a decoy website on HTTPS. 2) A secret WebSocket path proxies to Chisel/wstunnel on localhost. 3) Client connects via SOCKS5, traffic exits from the server.

**4. DOC-02: Supported OS table**

| ОС | Версия | Пакетный менеджер |
|----|--------|-------------------|
| Debian | 11+ | apt |
| Ubuntu | 20.04+ | apt |
| CentOS | 8+ | dnf |
| AlmaLinux | 8+ | dnf |
| Rocky Linux | 8+ | dnf |
| Fedora | 38+ | dnf |
| Arch Linux | Rolling | pacman |

Architecture: amd64 (x86_64), arm64 (aarch64).

**5. Quick start section (in a `<details>` block per DOC-03)**

```html
<details>
<summary><b>Быстрый старт (сервер)</b></summary>

```bash
curl -fLO https://raw.githubusercontent.com/.../proxyebator.sh
chmod +x proxyebator.sh
sudo ./proxyebator.sh server --domain example.com
```

</details>
```

**6. DOC-02: CLI flags table**

| Флаг | Режим | Описание | По умолчанию |
|------|-------|----------|--------------|
| `--domain DOMAIN` | server | Доменное имя сервера | (интерактивный запрос) |
| `--tunnel TYPE` | server/client | Бэкенд туннеля: `chisel` или `wstunnel` | `chisel` |
| `--port PORT` | server/client | Порт для прослушивания (server) или подключения (client) | `443` |
| `--masquerade MODE` | server | Режим маскировки: `stub`, `proxy`, `static` | `stub` |
| `--host HOST` | client | Хост сервера | (интерактивный запрос) |
| `--path PATH` | client | Секретный путь туннеля | (интерактивный запрос) |
| `--pass PASSWORD` | client | Пароль/токен авторизации | (интерактивный запрос) |
| `--socks-port PORT` | client | Локальный порт SOCKS5 | `1080` |
| `--yes` | uninstall | Пропустить подтверждение | (интерактивный запрос) |

**7. DOC-02: Environment variables / server.conf table**

| Переменная | Описание |
|-----------|----------|
| `DOMAIN` | Доменное имя |
| `LISTEN_PORT` | Порт nginx (обычно 443) |
| `SECRET_PATH` | Секретный WebSocket-путь |
| `TUNNEL_TYPE` | `chisel` или `wstunnel` |
| `TUNNEL_PORT` | Внутренний порт туннеля (7777 для chisel, 7778 для wstunnel) |
| `MASQUERADE_MODE` | Режим маскировки |
| `AUTH_USER` | Имя пользователя (только chisel) |
| `AUTH_TOKEN` | Токен авторизации (только chisel) |
| `NGINX_CONF` | Путь к конфигу nginx |
| `NGINX_INJECTED` | `true` если блок встроен в существующий конфиг |

**8. Server installation details (in `<details>` block)**

Detailed installation with 3 modes: interactive, non-interactive (AI-friendly with all flags), and re-run. Show examples for each.

**9. Client connection (in `<details>` block)**

Three modes: URL, flags, interactive. Examples:
```bash
# URL mode (copy from server output)
./proxyebator.sh client wss://proxyebator:TOKEN@example.com:443/SECRET/

# Flag mode
./proxyebator.sh client --host example.com --port 443 --path /SECRET/ --pass TOKEN

# wstunnel client
./proxyebator.sh client --host example.com --port 443 --path /SECRET/ --tunnel wstunnel
```

**10. DOC-04: GUI client instructions (each in its own `<details>` block)**

All instructions share the same SOCKS5 params: `127.0.0.1:1080`, SOCKS5, no auth.

**Throne (Linux) — recommended:**
- Download from github.com/throneproj/Throne
- Add server -> Type: SOCKS5 -> Host: 127.0.0.1 -> Port: 1080
- System Proxy mode for browsers
- TUN mode for all traffic (requires root)
- CRITICAL: TUN routing loop prevention rules:
  ```
  processName = chisel -> outbound: direct
  processName = wstunnel -> outbound: direct
  domain_suffix = YOURDOMAIN.COM -> outbound: direct
  ip_cidr = 127.0.0.1/32 -> outbound: direct
  ```

**nekoray / nekobox (Linux/Windows):**
- NOTE: Repository ARCHIVED since 2025. Last release: 4.0.1. Recommend Throne as replacement.
- Download from github.com/MatsuriDayo/nekoray
- Server -> Add -> SOCKS5 -> 127.0.0.1:1080

**Proxifier (Windows/macOS):**
- Commercial software from proxifier.com
- Profile -> Proxy Servers -> Add -> SOCKS Version 5 -> 127.0.0.1:1080
- Proxification Rules -> Add -> All applications -> through proxy

**Surge (macOS):**
- Commercial software from nssurge.com
- Policy: `proxyebator = socks5, 127.0.0.1, 1080`
- Route traffic via policy group

**Firefox (any OS):**
- Settings -> Network -> Manual proxy -> SOCKS Host: 127.0.0.1:1080 -> SOCKS v5
- IMPORTANT: check "Proxy DNS when using SOCKS v5" to prevent DNS leaks

**Verification command:**
```bash
curl --socks5-hostname localhost:1080 https://ifconfig.me
```

**11. Uninstall (in `<details>` block)**

```bash
sudo ./proxyebator.sh uninstall
sudo ./proxyebator.sh uninstall --yes  # without confirmation
```

Note: TLS certificate is preserved (Let's Encrypt rate limits).

**12. DOC-05: AI-assistant deployment block**

This is a special section with a fenced code block (or blockquote) that can be copy-pasted to any AI assistant:

```markdown
## Скопируй это и отправь AI-ассистенту

> Скопируй весь блок ниже и отправь Claude, ChatGPT, или другому AI-ассистенту — он развернёт proxyebator на твоём сервере.
```

Then a fenced block with complete instructions:
```
Задача: развернуть proxyebator — маскирующий WebSocket-прокси на моём Linux VPS.

Что нужно сделать:
1. Подключись к серверу по SSH (root или sudo)
2. Проверь что curl установлен: curl --version
3. Скачай скрипт: curl -fLO https://raw.githubusercontent.com/USER/REPO/main/proxyebator.sh
4. Сделай исполняемым: chmod +x proxyebator.sh
5. Запусти установку:
   sudo ./proxyebator.sh server --domain МОЙДОМЕН.COM --tunnel chisel
6. Дождись строки "=== ALL CHECKS PASSED ===" — это значит всё работает
7. Сохрани строку с командой для клиента (вывод после проверок)

Требования к серверу:
- Debian 12+, Ubuntu 22.04+, CentOS 8+, AlmaLinux 8+, Rocky 8+, Fedora 38+, или Arch
- Открытые порты 80/tcp (certbot) и 443/tcp
- Домен с A-записью на IP этого сервера (серое облако Cloudflare!)
- Root-доступ или sudo

Что НЕ делать:
- Не включать оранжевое облако Cloudflare — WebSocket не пройдёт через CDN
- Не запускать без домена — нужен TLS-сертификат для маскировки
- Не менять порт туннеля вручную — скрипт делает это автоматически
```

**13. DOC-06: Troubleshooting section (in `<details>` block)**

Table format:

| Проблема | Причина | Решение |
|----------|---------|---------|
| Cloudflare оранжевое облако | CF CDN буферирует WebSocket, таймаут ~100 сек | Переключить DNS на серое облако (DNS only) в CF Dashboard |
| DNS утечка (ISP видит домены) | SOCKS5 резолвит DNS локально | Firefox: `socks_remote_dns=true`; Throne: TUN режим |
| TUN: бесконечный reconnect | TUN перехватывает трафик клиента | Правило: processName chisel/wstunnel -> direct |
| WebSocket 404 | Нет trailing slash в URL | URL должен заканчиваться на `/SECRET/` |
| Connected, но curl зависает | Нет `proxy_buffering off` в nginx | Переустановить скрипт (директива уже включена) |
| Порт туннеля виден снаружи | Туннель слушает 0.0.0.0 | Переустановить — скрипт привязывает к 127.0.0.1 |
| verify: Cloudflare IP | A-запись через оранжевое облако | Серое облако в CF Dashboard |
| certbot: challenge failed | Порт 80 занят или DNS не указывает на сервер | Проверить: `curl http://DOMAIN` с другой машины |

**14. Chisel vs wstunnel comparison table**

| | Chisel | wstunnel |
|---|--------|---------|
| SOCKS5 | Серверная сторона (`--socks5`) | Клиентская сторона (`-L socks5://`) |
| Авторизация | authfile (user:pass) | nginx location block (секретный путь) |
| Внутренний порт | 7777 | 7778 |
| Бинарник | chisel (.gz) | wstunnel (.tar.gz) |

**15. License section**

MIT (or whatever the project uses).

**FORMATTING RULES:**
- All text in Russian
- Use `<details><summary>` for all major sections (installation, client, GUI clients, uninstall, troubleshooting)
- Tables use standard GitHub Markdown (`| col | col |`)
- Code blocks use triple backticks with language hint (bash, ini, nginx)
- No emojis anywhere
- Shields.io badges in the centered header div
- Blank line after `<summary>` tag and before `</details>` tag (required for GitHub Markdown rendering)
  </action>
  <verify>
1. `wc -l README.md` shows 300+ lines.
2. `grep -c 'shields.io' README.md` >= 3 (badges present).
3. `grep -c '<details>' README.md` >= 5 (collapsible sections used throughout).
4. `grep -c 'Throne' README.md` >= 2 (GUI client documented).
5. `grep -c 'nekoray\|nekobox' README.md` >= 2 (archived client documented).
6. `grep -c 'Proxifier' README.md` >= 2 (Windows/macOS client documented).
7. `grep -c 'Surge' README.md` >= 1 (macOS client documented).
8. `grep -c 'AI-ассистент\|AI assistant' README.md` >= 1 (AI block present).
9. `grep -c 'Cloudflare\|DNS.*утечка\|TUN.*reconnect' README.md` >= 3 (troubleshooting pitfalls).
10. `grep -c 'proxyebator.sh' README.md` >= 5 (CLI commands documented).
  </verify>
  <done>
- README.md exists in project root with 300+ lines
- Centered header with 5 shields.io badges (Platform, Shell, License, Chisel, wstunnel)
- Supported OS table, CLI flags table, server.conf variables table
- 5+ collapsible `<details>` sections for major content areas
- GUI client instructions for Throne (with TUN loop prevention), nekoray (with archive notice), Proxifier, Surge, Firefox
- AI-assistant deployment block with numbered steps and requirements
- Troubleshooting table with 7+ known pitfalls and solutions
- Entire README in Russian
  </done>
</task>

</tasks>

<verification>
1. README.md renders correctly on GitHub (valid Markdown + HTML).
2. All 6 DOC requirements covered: DOC-01 (badges), DOC-02 (tables), DOC-03 (details), DOC-04 (GUI clients), DOC-05 (AI block), DOC-06 (troubleshooting).
3. No broken Markdown syntax (unclosed tags, missing blank lines around HTML).
</verification>

<success_criteria>
1. README.md has 300+ lines of Russian documentation
2. Contains shields.io badge URLs in centered div
3. Contains 3+ markdown tables (CLI flags, env vars, OS support)
4. Contains 5+ `<details>` collapsible blocks
5. Contains setup instructions for Throne, nekoray, Proxifier, Surge
6. Contains copy-paste AI deployment block
7. Contains troubleshooting section with Cloudflare, DNS leaks, TUN routing loop
</success_criteria>

<output>
After completion, create `.planning/phases/06-wstunnel-backend-and-readme/06-02-SUMMARY.md`
</output>
